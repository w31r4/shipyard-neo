# Bay Configuration
# This file can be placed at:
# - ./config.yaml (development)
# - /etc/bay/config.yaml (production)
# - Or set BAY_CONFIG_FILE environment variable

server:
  host: "0.0.0.0"
  port: 8000

database:
  # Phase 1: SQLite (single instance)
  # For production: postgresql+asyncpg://user:pass@host/dbname
  url: "sqlite+aiosqlite:///./bay.db"
  echo: false

driver:
  type: docker  # docker | k8s

  docker:
    socket: "unix:///var/run/docker.sock"

    # Bay ↔ Runtime 连通模式：
    # - host_port: Bay 跑在宿主机上（最常见）。通过 publish 端口映射访问 runtime。
    # - container_network: Bay 跑在容器内且与 runtime 同网络，通过容器 IP 直连。
    # - auto: 优先 container_network，失败回退 host_port。
    connect_mode: host_port

    # host_port 模式下 Bay 访问 runtime 的 host 地址
    host_address: "127.0.0.1"

    # 是否发布端口（host_port/auto 必须为 true 才能动态获取 HostPort）
    publish_ports: true

    # 固定宿主机端口（null/0 表示随机端口）
    host_port: null

    # container_network/auto 时可指定网络名；host_port 模式可不填
    network: null

workspace:
  root_path: "/var/lib/bay/workspaces"
  default_size_limit_mb: 1024
  mount_path: "/workspace"  # Fixed, do not change

security:
  jwt_secret: "${JWT_SECRET:dev-secret-change-in-production}"
  jwt_algorithm: "HS256"
  jwt_expire_minutes: 60
  blocked_hosts:
    - "169.254.0.0/16"  # Cloud metadata
    - "10.0.0.0/8"
    - "172.16.0.0/12"
    - "192.168.0.0/16"

# Runtime profiles
# These define the available sandbox configurations
profiles:
  - id: python-default
    image: "ship:latest"

    # runtime 容器内 HTTP 端口（Ship 当前默认是 8123，见 ship 镜像启动日志）
    runtime_port: 8123

    resources:
      cpus: 1.0
      memory: "1g"
    capabilities:
      - filesystem
      - shell
      - ipython
    idle_timeout: 1800  # 30 minutes
    env: {}

  - id: python-data
    image: "ship:data"
    runtime_port: 8123
    resources:
      cpus: 2.0
      memory: "4g"
    capabilities:
      - filesystem
      - shell
      - ipython
    idle_timeout: 1800
    env: {}

  # Example: GPU profile (Phase 2+)
  # - id: python-gpu
  #   image: "ship:gpu"
  #   runtime_port: 8123
  #   resources:
  #     cpus: 4.0
  #     memory: "16g"
  #   capabilities:
  #     - filesystem
  #     - shell
  #     - ipython
  #   idle_timeout: 3600
  #   env:
  #     CUDA_VISIBLE_DEVICES: "0"
